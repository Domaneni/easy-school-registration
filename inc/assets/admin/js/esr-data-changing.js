jQuery((function(t){function e(t){t.find("input:not([type=submit])").val(""),t.find("textarea").val(""),t.find("select").val(null)}function a(){t("body").append('<div id="esr-waiting"></div>');var e=document.getElementById("esr-waiting");new Spinner({lines:13,length:28,width:14,radius:42,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"}).spin(e)}function s(){t("#esr-waiting").remove()}t(document).on("click",".esr-edit-box .close",(function(){var a=t(".esr-edit-box");e(a),a.hide()})).on("click",".esr-actions-box.esr-registrations-actions .esr-action.edit",(function(){var a;e(a=t(".esr-edit-box")),a.show();let s=t(this).closest(".esr-actions-box");!function(e){var a=t(".esr-edit-box");a.find("[name=student_email]").val(e.data("student-email")),a.find("[name=course_id]").val(parseInt(e.data("course-id"))),a.find("[name=dancing_as]").val(parseInt(e.data("dancing-as"))),a.find("[name=dancing_with]").val(e.data("dancing-with")),a.find("[name=partner_email]").val(e.data("partner-email")),a.find("[name=registration_id]").val(e.data("id"))}(t(`.esr-row[data-id=${s.data("id")}]`)),t("html, body").animate({scrollTop:t("#esr-edit-box").offset().top-25},2e3)})),t("body").on("click","[name=esr_registration_edit_submit]",(function(a){a.preventDefault();var s=t(".esr-edit-box");t(".esr-error",s).remove();var r={action:"esr_edit_registration",registration_id:s.find("[name=registration_id]").val(),student_email:s.find("[name=student_email]").val(),course_id:s.find("[name=course_id]").val(),dancing_as:s.find("[name=dancing_as]").val(),dancing_with:s.find("[name=dancing_with]").val(),partner_email:s.find("[name=partner_email]").val()};t.post(ajaxurl,r,(function(a){if("-1"!==a){var r=jQuery.parseJSON(a);if(r.hasOwnProperty("error"))r.error.hasOwnProperty("student")?t(".esr-student td").append("<span class='esr-error'>"+r.error.student+"</span>"):r.error.hasOwnProperty("partner")&&t(".esr-registered-partner td").append("<span class='esr-error'>"+r.error.partner+"</span>");else{var n=t(".esr-row[data-id="+s.find("[name=registration_id]").val()+"]");e(s),s.hide(),r.hasOwnProperty("student")&&(r.student.hasOwnProperty("name")&&n.find(".student-name:not(.first-name):not(.last-name)").html(r.student.name),r.student.hasOwnProperty("first_name")&&n.find(".student-name.first-name").html(r.student.first_name),r.student.hasOwnProperty("last_name")&&n.find(".student-name.last-name").html(r.student.last_name),r.student.hasOwnProperty("email")&&(n.data("student-email",r.student.email),n.find(".student-email").html(r.student.email))),r.hasOwnProperty("dancing_as")&&(r.dancing_as.hasOwnProperty("id")&&n.data("dancing-as",r.dancing_as.id),r.dancing_as.hasOwnProperty("text")&&n.find(".dancing-as").html(r.dancing_as.text)),r.hasOwnProperty("partner")&&(r.partner.hasOwnProperty("name")&&n.find(".partner-name").html(r.partner.name),r.partner.hasOwnProperty("email")&&n.data("partner-email",r.partner.email)),r.hasOwnProperty("dancing_with")&&r.dancing_with.hasOwnProperty("email")&&(n.find(".dancing-with").html(r.dancing_with.email),n.data("dancing-with",r.dancing_with.email)),r.hasOwnProperty("course")&&n.data("course-id",r.course.id).find(".course").html(r.course.id+" - "+r.course.title+" ("+r.course.day_title+")"),r.hasOwnProperty("confirm_registrations")&&(r.confirm_registrations.hasOwnProperty("student")&&n.removeClass("status-1").removeClass("status-3").addClass("status-2").find(".status").text(a.status_title),r.confirm_registrations.hasOwnProperty("partner")&&t(".esr-row[data-id="+r.confirm_registrations.partner.reg_id+"]").removeClass("status-1").removeClass("status-3").addClass("status-2").find(".status").text(a.status_title))}}}))})).on("click",".esr-actions-box.esr-registrations-actions .esr-action.remove",(function(){a();let e=t(this).closest(".esr-actions-box"),r=t(`.esr-row[data-id=${e.data("id")}]`);var n={action:"esr_remove_user_course_registration",registration_id:r.data("id")};t.post(ajaxurl,n,(function(e){if("-1"!==e&&(r.removeClass("status-1").removeClass("status-2").addClass("status-3").find(".status").text(e.status_title),r.find("td.dancing-with").empty(),r.find("td.partner-name").empty(),Number.parseInt(e.partner_registration)>0)){var a=t("tr[data-id='"+e.partner_registration+"']");a.find("td.dancing-with").empty(),a.find("td.partner-name").empty()}s()}))})).on("click",".esr-actions-box.esr-registrations-actions .esr-action.remove-forever",(function(){let e=t(this).closest(".esr-actions-box"),a=t(`.esr-row[data-id=${e.data("id")}]`);var s={action:"esr_remove_registration_forever",registration_id:a.data("id")};t.post(ajaxurl,s,(function(t){"-1"!==t&&a.remove()}))})).on("click",".esr-actions-box.esr-registrations-actions .esr-action.update-free-registration",(function(){t(this);let e=t(this).closest(".esr-actions-box"),a=t(`.esr-row[data-id=${e.data("id")}]`);if(a.hasClass("free-registration-status-0")){let e={action:"esr_set_free_registration",registration_id:a.data("id")};t.post(ajaxurl,e,(function(e){a.removeClass("free-registration-status-0").addClass("free-registration-status-"+e.free_registration),t.notify({message:e.message},{type:e.type})}))}else if(a.hasClass("free-registration-status-1")){let e={action:"esr_set_paid_registration",registration_id:a.data("id")};t.post(ajaxurl,e,(function(e){a.removeClass("free-registration-status-1").addClass("free-registration-status-"+e.free_registration),t.notify({message:e.message},{type:e.type})}))}})).on("click",".esr-actions-box.esr-registrations-actions .esr-action.confirm",(function(){a();let e=t(this).closest(".esr-actions-box"),r=t(`.esr-row[data-id=${e.data("id")}]`);var n={action:"esr_add_user_course_registration",esr_registration_id:r.data("id")};t.post(ajaxurl,n,(function(t){"-1"!==t&&r.removeClass("status-1").removeClass("status-3").addClass("status-2").find(".status").text(t.status_title),s()}))}))}));